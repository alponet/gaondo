{% if comments|length < 1 %}
    <div>no comments</div>
{% endif %}

{% macro comment_tree(tree) %}
    {% import _self as macros %}
    {% for node in tree %}
        <li>
            <div class="comment" id="comment{{ node.comment.id }}">
                <div class="info">
                    {% embed "user/widget.html.twig" with { user: node.comment.author} %}{% endembed %}{{ node.comment.creationDate|date('d.m.Y / H:m') }}</div>
                <div class="text">{{ node.comment.text }}</div>
                {% if app.user %}
                    <div class="actions"><span class="link" onclick="replyForm({{ node.comment.id }})">{% trans %}main.reply{% endtrans %}</span></div>
                {% endif %}
            </div>

            {% if node.children is defined %}
                <ul>
                    {{ macros.comment_tree(node.children) }}
                </ul>
            {% endif %}

        </li>
    {% endfor %}
{% endmacro %}

{% import _self as macros %}

<ul class="comments">
    {{ macros.comment_tree(tree) }}
</ul>
<script type="text/javascript">
    function replyForm(subjectId) {
        $('#commentForm').clone().attr('id', 'commentForm'+subjectId).appendTo('#comment'+subjectId);
        $('#commentForm'+subjectId+' #comment_replyTo').val(subjectId);
    }
</script>